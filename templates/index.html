<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë³´ì•ˆ ìœ„í‚¤</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header>
    <div class="logo" onclick="location.href='/'">ğŸ” ë³´ì•ˆìœ„í‚¤</div>
    <div class="search-box">
      <input
        type="text"
        id="searchInput"
        placeholder="ë³´ì•ˆ ìš©ì–´ ê²€ìƒ‰..."
        onkeydown="handleKey(event)">
    </div>
    <div class="add-button">
      <a href="/add">â• ìš©ì–´ ì¶”ê°€</a>
    </div>
  </header>

  <div id="main-container">
    <nav id="category">
      <h3>ì¹´í…Œê³ ë¦¬</h3>
      <ul id="categoryList">
        <!-- ì¹´í…Œê³ ë¦¬ ë™ì  ìƒì„± -->
      </ul>
      <h4>ì¶”ì²œ ìš©ì–´</h4>
      <ul id="recommendedList">
        <!-- ì¶”ì²œ ìš©ì–´ ë™ì  ìƒì„± -->
      </ul>
    </nav>

    <section id="content">
      <h1>ë³´ì•ˆ ìœ„í‚¤ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤</h1>
      <p>ì™¼ìª½ ì¹´í…Œê³ ë¦¬ ë˜ëŠ” ì¶”ì²œ ìš©ì–´ë¥¼ í´ë¦­í•´ë³´ì„¸ìš”.</p>
    </section>
  </div>

  <script>
    function handleKey(event) {
      if (event.key === "Enter") {
        event.preventDefault();
        searchTerm();
      }
    }

    function searchTerm() {
      const keyword = document.getElementById("searchInput").value.toLowerCase();
      fetch("/api/terms")
        .then(res => res.json())
        .then(data => {
          const match = data.find(term => term.title.toLowerCase().includes(keyword));
          if (match) {
            location.href = `/term/${match.title}`;
          } else {
            alert("âŒ í•´ë‹¹ ìš©ì–´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          }
        });
    }

    function updateCategoryMenu() {
      fetch("/api/terms")
        .then(res => res.json())
        .then(terms => {
          const categories = new Set(["web", "network", "system"]);
          terms.forEach(term => categories.add(term.category));
          const list = document.getElementById("categoryList");
          list.innerHTML = "";
          categories.forEach(cat => {
            const li = document.createElement("li");
            li.textContent = (cat === "ê¸°íƒ€") ? "ê¸°íƒ€" : `${cat.charAt(0).toUpperCase() + cat.slice(1)} ë³´ì•ˆ`;
            li.onclick = () => filterCategory(cat, terms);
            list.appendChild(li);
          });
        });
    }

    function updateRecommendedTerms() {
      fetch("/api/terms")
        .then(res => res.json())
        .then(terms => {
          const list = document.getElementById("recommendedList");
          list.innerHTML = "";
          terms.slice(0, 5).forEach(term => {
            const li = document.createElement("li");
            const link = document.createElement("a");
            link.href = `/term/${term.title}`;
            link.textContent = term.title;
            li.appendChild(link);
            list.appendChild(li);
          });
        });
    }

    function filterCategory(cat, terms) {
      const filtered = terms.filter(t => t.category === cat);
      const html = `
        <h1>${cat.toUpperCase()} ë³´ì•ˆ ìš©ì–´</h1>
        <ul>
          ${filtered.map(t => `<li><a href="/term/${t.title}">${t.title}</a></li>`).join('')}
        </ul>
      `;
      document.getElementById("content").innerHTML = html;
    }

    window.onload = function () {
      updateRecommendedTerms();
      updateCategoryMenu();
    };
  </script>
</body>
</html>
